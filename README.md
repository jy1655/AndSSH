# OpenCode SSH Terminal (MVP Scaffold)

Android native SSH terminal app scaffold focused on TTY-based remote CLI workflows.

## What is included

- Minimal Android Compose app module
- Foreground service skeleton for long-running SSH sessions
- Session state machine (`IDLE/CONNECTING/CONNECTED/FAILED`)
- SSH abstraction interfaces (`SshClient`, `SshSession`)
- `sshj`-based real SSH adapter with `PTY shell`, `window-change`, and stream read/write loop
- Host key change detection UX (fingerprint dialog with `Reject (Default)`, `Trust Once`, `Update known_hosts`)
- stdin 입력 UI (`Ctrl/Alt/ESC/TAB/ENTER`, 방향키, `^C/^D`, 실시간 키 입력 전송)
- SFTP 파일 브라우저: 영속 세션, 자동 디렉터리 리스팅, SAF 기반 업로드/다운로드(진행률 표시), mkdir/삭제/이름변경, 롱프레스 컨텍스트 메뉴
- Android 14+/targetSdk 35 foreground service 권한 정리 (`FOREGROUND_SERVICE_DATA_SYNC`)
- 터미널 렌더링 개선: Nerd Font 번들 적용 + truecolor(24-bit) 색상 처리
- GitHub Actions CI: `assembleDebug` + `testDebugUnitTest`
- Placeholder key repository interface for Keystore+AEAD implementation

- 한글/CJK 입력 정상 처리 (IME composition 인식) + 전각 문자 렌더링
- 터미널 스크롤백 (드래그로 이전 출력 확인, 2000줄 버퍼)

## Current scope

SSH 터미널 + SFTP 파일 관리가 동작하는 상태. `sshj` 기반.

## Build & test (CLI, WSL 기준)

This repository now includes Gradle Wrapper (`gradlew`).

1. Prepare environment variables:

```bash
export JAVA_HOME=/home/h1655/Dev/android-ssh/.local/jdk/jdk-17.0.14+7
export ANDROID_SDK_ROOT=/home/h1655/Dev/android-ssh/.local/android-sdk
export GRADLE_USER_HOME=/home/h1655/Dev/android-ssh/.gradle-local
export PATH="$JAVA_HOME/bin:$ANDROID_SDK_ROOT/platform-tools:$PATH"
```

2. Build debug APK:

```bash
./gradlew assembleDebug
```

3. Run unit tests:

```bash
./gradlew --no-daemon testDebugUnitTest
```

Output APK path:

- `app/build/outputs/apk/debug/app-debug.apk`

## Run on Android device

1. (WSL2) Windows PowerShell에서 폰을 WSL로 attach:

```powershell
usbipd bind --busid <BUSID>
usbipd attach --wsl --busid <BUSID>
```

2. WSL에서 ADB 연결 확인 (`device` 상태여야 함):

```bash
adb devices -l
```

3. 디버그 앱 설치:

```bash
./gradlew --no-daemon installDebug
```

4. 앱 실행:

```bash
adb shell am start -n com.opencode.sshterminal/.app.MainActivity
```

If `unauthorized` appears, approve the RSA debugging prompt on the phone.
If `no permissions` appears, add a udev rule for your vendor ID and reload rules.

## Next implementation order

1. Replace custom Compose renderer with `terminal-view` integration (or `libvterm`-based engine)
2. Implement `KeyRepository` with Android Keystore-backed AEAD encryption
3. SFTP 개선: pull-to-refresh (Compose BOM 업그레이드 필요), 재귀 디렉터리 삭제, 다중 파일 선택

## Important paths

- `app/src/main/java/com/opencode/sshterminal/session/SessionManager.kt`
- `app/src/main/java/com/opencode/sshterminal/ssh/SshClient.kt`
- `app/src/main/java/com/opencode/sshterminal/terminal/TermuxTerminalBridge.kt`
- `app/src/main/java/com/opencode/sshterminal/service/SshForegroundService.kt`
- `app/src/main/java/com/opencode/sshterminal/sftp/SftpChannelAdapter.kt`
- `app/src/main/java/com/opencode/sshterminal/sftp/SshjSftpAdapter.kt`
- `app/src/main/java/com/opencode/sshterminal/ui/sftp/SftpBrowserViewModel.kt`
- `app/src/main/java/com/opencode/sshterminal/ui/sftp/SftpBrowserScreen.kt`
- `app/src/test/java/com/opencode/sshterminal/sftp/SshjSftpAdapterTest.kt`
